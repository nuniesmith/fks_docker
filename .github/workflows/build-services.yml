name: Build and Push Service Images

on:
  workflow_dispatch:
    inputs:
      service:
        description: "Service to build (leave empty for all)"
        required: false
        type: choice
        options:
          - ""
          - web
          - api
          - app
          - data
          - ai
          - analyze
          - training
          - portfolio
          - monitor
          - ninja
          - execution
          - auth
          - meta
          - main
          - tailscale
          - nginx
  schedule:
    # Run daily at 2 AM UTC to rebuild images
    - cron: "0 2 * * *"
  push:
    branches: [main]
    paths:
      - "Dockerfile.*"
      - "build-all.sh"

jobs:
  build-services:
    uses: nuniesmith/fks_actions/.github/workflows/build-docker-service-images.yml@main
    with:
      docker_repo: nuniesmith/fks
      service: ${{ github.event.inputs.service }}
      push_images: true
      build_script: build-all.sh
    secrets:
      DOCKER_TOKEN: ${{ secrets.DOCKER_TOKEN }}
