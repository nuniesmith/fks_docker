name: Build and Push All Service Images

on:
  push:
    branches: [main, develop]
    paths:
      - 'Dockerfile.*'
      - 'build-all.sh'
      - '.github/workflows/build-all-services.yml'
  pull_request:
    branches: [main]
  workflow_dispatch:
    inputs:
      service:
        description: 'Specific service to build (leave empty for all)'
        required: false
        type: string

jobs:
  build-all-services:
    uses: nuniesmith/fks_actions/.github/workflows/build-docker-service-images.yml@main
    with:
      docker_repo: nuniesmith/fks
      service: ${{ github.event.inputs.service }}
      push_images: ${{ github.event_name != 'pull_request' }}
      build_script: build-all.sh
    secrets:
      DOCKER_TOKEN: ${{ secrets.DOCKER_TOKEN }}
